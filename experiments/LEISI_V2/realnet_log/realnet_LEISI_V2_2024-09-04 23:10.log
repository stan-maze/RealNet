[2024-09-04 23:10:00,219][train_realnet.py][line: 121][    INFO] args: Namespace(class_name='LEISI_V2', config='experiments/LEISI_V2/realnet.yaml', dataset='LEISI_V2', local_rank=0)
[2024-09-04 23:10:00,221][train_realnet.py][line: 122][    INFO] config: {'checkpoints_path': 'experiments/LEISI_V2/realnet_checkpoints/',
 'criterion': [{'kwargs': {'weight': 1.0},
                'name': 'SegmentCrossEntropyLoss',
                'type': 'SegmentCrossEntropyLoss'},
               {'kwargs': {'weight': 1.0},
                'name': 'FeatureMSELoss',
                'type': 'FeatureMSELoss'}],
 'dataset': {'batch_size': 8,
             'image_reader': {'kwargs': {'color_mode': 'RGB',
                                         'image_dir': 'data/LEISI_V2/leisi/'},
                              'type': 'opencv'},
             'input_size': [256, 256],
             'pixel_mean': [0.278, 0.278, 0.278],
             'pixel_std': [0.238, 0.238, 0.238],
             'test': {'meta_file': './data/LEISI_V2/samples/test_LEISI_V2.json'},
             'train': {'anomaly_types': {'dtd': 0.5, 'normal': 0.5},
                       'dtd_dir': 'data/DTD/images',
                       'dtd_transparency_range': [0.2, 1.0],
                       'hflip': False,
                       'meta_file': 'data/LEISI_V2/samples/train_LEISI_V2.json',
                       'min_perlin_scale': 0,
                       'perlin_scale': 6,
                       'rotate': False,
                       'sdas_dir': 'data/LEISI_V2/sdas/LEISI_V2',
                       'sdas_transparency_range': [0.5, 1.0],
                       'vflip': False},
             'type': 'LEISI_V2',
             'workers': 12},
 'evaluator': {'key_metric': 'mean',
               'metrics': {'auc': [{'kwargs': {'avgpool_size': [16, 16]},
                                    'name': 'image'},
                                   {'name': 'pixel'}]}},
 'exp_path': 'experiments/LEISI_V2',
 'log_path': 'experiments/LEISI_V2/realnet_log/',
 'net': [{'frozen': True,
          'kwargs': {'backbone': 'wide_resnet50_2',
                     'outlayers': ['layer1', 'layer2', 'layer3', 'layer4']},
          'name': 'backbone',
          'type': 'models.backbones.Backbone'},
         {'frozen': True,
          'kwargs': {'init_bsn': 64,
                     'structure': [{'layers': [{'idx': 'layer1',
                                                'planes': 256}],
                                    'name': 'block1',
                                    'stride': 4},
                                   {'layers': [{'idx': 'layer2',
                                                'planes': 512}],
                                    'name': 'block2',
                                    'stride': 8},
                                   {'layers': [{'idx': 'layer3',
                                                'planes': 512}],
                                    'name': 'block3',
                                    'stride': 16},
                                   {'layers': [{'idx': 'layer4',
                                                'planes': 256}],
                                    'name': 'block4',
                                    'stride': 32}]},
          'name': 'afs',
          'prev': 'backbone',
          'type': 'models.afs.AFS'},
         {'kwargs': {'attention_mult': [2, 4],
                     'channel_mult': [1, 2, 4],
                     'hide_channels_ratio': 0.5,
                     'num_res_blocks': 2},
          'name': 'recon',
          'prev': 'afs',
          'type': 'models.recon.ReconstructionLayer'},
         {'kwargs': {'mode_numbers': [256, 256],
                     'modes': ['max', 'mean'],
                     'num_residual_layers': 2,
                     'stop_grad': False},
          'name': 'rrs',
          'prev': 'recon',
          'type': 'models.rrs.RRS'}],
 'random_seed': 100,
 'saver': {'checkpoints_dir': 'realnet_checkpoints/',
           'log_dir': 'realnet_log/',
           'vis_dir': 'realnet_vis/'},
 'structure': [{'layers': [{'idx': 'layer1', 'planes': 256}],
                'name': 'block1',
                'stride': 4},
               {'layers': [{'idx': 'layer2', 'planes': 512}],
                'name': 'block2',
                'stride': 8},
               {'layers': [{'idx': 'layer3', 'planes': 512}],
                'name': 'block3',
                'stride': 16},
               {'layers': [{'idx': 'layer4', 'planes': 256}],
                'name': 'block4',
                'stride': 32}],
 'trainer': {'max_epoch': 1000,
             'optimizer': {'kwargs': {'betas': [0.9, 0.999], 'lr': 0.0001},
                           'type': 'Adam'},
             'print_freq_step': 20,
             'val_freq_epoch': 5},
 'version': 'v1.0.0'}
[2024-09-04 23:10:00,221][train_realnet.py][line: 123][    INFO] class name is : LEISI_V2
[2024-09-04 23:10:08,623][ misc_helper.py][line:  54][    INFO] ************* model summary *************
[2024-09-04 23:10:08,624][ misc_helper.py][line:  56][    INFO] backbone: 66834240 param
[2024-09-04 23:10:08,625][ misc_helper.py][line:  56][    INFO] afs: 1536 param
[2024-09-04 23:10:08,628][ misc_helper.py][line:  56][    INFO] recon: 518236160 param
[2024-09-04 23:10:08,628][ misc_helper.py][line:  56][    INFO] rrs: 5872662 param
[2024-09-04 23:10:08,631][ misc_helper.py][line:  59][    INFO] ************* model summary *************
[2024-09-04 23:10:08,631][ misc_helper.py][line:  60][    INFO] total: 590944598 param
[2024-09-04 23:10:08,631][ misc_helper.py][line:  61][    INFO] frozen: 66835776 param
[2024-09-04 23:10:08,631][ misc_helper.py][line:  62][    INFO] trainable: 524108822 param
[2024-09-04 23:10:08,631][ misc_helper.py][line:  63][    INFO] ************* model summary *************
[2024-09-04 23:10:39,432][train_realnet.py][line: 153][    INFO] layers: ['backbone', 'afs', 'recon', 'rrs']
[2024-09-04 23:10:39,432][train_realnet.py][line: 154][    INFO] frozen layers: ['backbone', 'afs']
[2024-09-04 23:10:39,432][train_realnet.py][line: 155][    INFO] active layers: ['recon', 'rrs']
[2024-09-04 23:10:54,624][train_realnet.py][line: 121][    INFO] args: Namespace(class_name='LEISI_V2', config='experiments/LEISI_V2/realnet.yaml', dataset='LEISI_V2', local_rank=0)
[2024-09-04 23:10:54,627][train_realnet.py][line: 122][    INFO] config: {'checkpoints_path': 'experiments/LEISI_V2/realnet_checkpoints/',
 'criterion': [{'kwargs': {'weight': 1.0},
                'name': 'SegmentCrossEntropyLoss',
                'type': 'SegmentCrossEntropyLoss'},
               {'kwargs': {'weight': 1.0},
                'name': 'FeatureMSELoss',
                'type': 'FeatureMSELoss'}],
 'dataset': {'batch_size': 8,
             'image_reader': {'kwargs': {'color_mode': 'RGB',
                                         'image_dir': 'data/LEISI_V2/leisi/'},
                              'type': 'opencv'},
             'input_size': [256, 256],
             'pixel_mean': [0.278, 0.278, 0.278],
             'pixel_std': [0.238, 0.238, 0.238],
             'test': {'meta_file': './data/LEISI_V2/samples/test_LEISI_V2.json'},
             'train': {'anomaly_types': {'dtd': 0.5, 'normal': 0.5},
                       'dtd_dir': 'data/DTD/images',
                       'dtd_transparency_range': [0.2, 1.0],
                       'hflip': False,
                       'meta_file': 'data/LEISI_V2/samples/train_LEISI_V2.json',
                       'min_perlin_scale': 0,
                       'perlin_scale': 6,
                       'rotate': False,
                       'sdas_dir': 'data/LEISI_V2/sdas/LEISI_V2',
                       'sdas_transparency_range': [0.5, 1.0],
                       'vflip': False},
             'type': 'LEISI_V2',
             'workers': 12},
 'evaluator': {'key_metric': 'mean',
               'metrics': {'auc': [{'kwargs': {'avgpool_size': [16, 16]},
                                    'name': 'image'},
                                   {'name': 'pixel'}]}},
 'exp_path': 'experiments/LEISI_V2',
 'log_path': 'experiments/LEISI_V2/realnet_log/',
 'net': [{'frozen': True,
          'kwargs': {'backbone': 'wide_resnet50_2',
                     'outlayers': ['layer1', 'layer2', 'layer3', 'layer4']},
          'name': 'backbone',
          'type': 'models.backbones.Backbone'},
         {'frozen': True,
          'kwargs': {'init_bsn': 64,
                     'structure': [{'layers': [{'idx': 'layer1',
                                                'planes': 256}],
                                    'name': 'block1',
                                    'stride': 4},
                                   {'layers': [{'idx': 'layer2',
                                                'planes': 512}],
                                    'name': 'block2',
                                    'stride': 8},
                                   {'layers': [{'idx': 'layer3',
                                                'planes': 512}],
                                    'name': 'block3',
                                    'stride': 16},
                                   {'layers': [{'idx': 'layer4',
                                                'planes': 256}],
                                    'name': 'block4',
                                    'stride': 32}]},
          'name': 'afs',
          'prev': 'backbone',
          'type': 'models.afs.AFS'},
         {'kwargs': {'attention_mult': [2, 4],
                     'channel_mult': [1, 2, 4],
                     'hide_channels_ratio': 0.25,
                     'num_res_blocks': 2},
          'name': 'recon',
          'prev': 'afs',
          'type': 'models.recon.ReconstructionLayer'},
         {'kwargs': {'mode_numbers': [256, 256],
                     'modes': ['max', 'mean'],
                     'num_residual_layers': 2,
                     'stop_grad': False},
          'name': 'rrs',
          'prev': 'recon',
          'type': 'models.rrs.RRS'}],
 'random_seed': 100,
 'saver': {'checkpoints_dir': 'realnet_checkpoints/',
           'log_dir': 'realnet_log/',
           'vis_dir': 'realnet_vis/'},
 'structure': [{'layers': [{'idx': 'layer1', 'planes': 256}],
                'name': 'block1',
                'stride': 4},
               {'layers': [{'idx': 'layer2', 'planes': 512}],
                'name': 'block2',
                'stride': 8},
               {'layers': [{'idx': 'layer3', 'planes': 512}],
                'name': 'block3',
                'stride': 16},
               {'layers': [{'idx': 'layer4', 'planes': 256}],
                'name': 'block4',
                'stride': 32}],
 'trainer': {'max_epoch': 1000,
             'optimizer': {'kwargs': {'betas': [0.9, 0.999], 'lr': 0.0001},
                           'type': 'Adam'},
             'print_freq_step': 20,
             'val_freq_epoch': 5},
 'version': 'v1.0.0'}
[2024-09-04 23:10:54,627][train_realnet.py][line: 123][    INFO] class name is : LEISI_V2
[2024-09-04 23:10:59,506][ misc_helper.py][line:  54][    INFO] ************* model summary *************
[2024-09-04 23:10:59,508][ misc_helper.py][line:  56][    INFO] backbone: 66834240 param
[2024-09-04 23:10:59,508][ misc_helper.py][line:  56][    INFO] afs: 1536 param
[2024-09-04 23:10:59,511][ misc_helper.py][line:  56][    INFO] recon: 131118848 param
[2024-09-04 23:10:59,511][ misc_helper.py][line:  56][    INFO] rrs: 5872662 param
[2024-09-04 23:10:59,515][ misc_helper.py][line:  59][    INFO] ************* model summary *************
[2024-09-04 23:10:59,515][ misc_helper.py][line:  60][    INFO] total: 203827286 param
[2024-09-04 23:10:59,515][ misc_helper.py][line:  61][    INFO] frozen: 66835776 param
[2024-09-04 23:10:59,515][ misc_helper.py][line:  62][    INFO] trainable: 136991510 param
[2024-09-04 23:10:59,515][ misc_helper.py][line:  63][    INFO] ************* model summary *************
[2024-09-04 23:11:30,331][train_realnet.py][line: 153][    INFO] layers: ['backbone', 'afs', 'recon', 'rrs']
[2024-09-04 23:11:30,332][train_realnet.py][line: 154][    INFO] frozen layers: ['backbone', 'afs']
[2024-09-04 23:11:30,332][train_realnet.py][line: 155][    INFO] active layers: ['recon', 'rrs']
[2024-09-04 23:11:46,553][train_realnet.py][line: 270][    INFO] Epoch: [1/1000]	Iter: [20/550000]	Loss 38.14552 (41.97218)	
